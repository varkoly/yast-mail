/**
 * Module:
 *   NIS client configuration
 *
 * Summary:
 *   Testsuite
 *
 * Authors:
 *   Martin Vidner <mvidner@suse.cz>
 *
 * $Id$
 */
{
    include "testsuite.ycp";
    TESTSUITE_INIT ([ $[], $[], $[] ], nil);
    import "MailTable";
    import "MailAliases";

    MailTable::SetFileName ("aliases", "tests/aliases.out");

    // the test data is a bit convoluted because formerly
    // the data was read from .mail.{sendmail,postfix}.aliases.table

    map READ_s = $[
	// targetpkg:
	"targetpkg": $[
	    // sendmail
	    "installed": true,
	    ],
	];

    map READ_p1 = $[
	// targetpkg:
	"targetpkg": $[
	    // sendmail
	    "installed": false,
	    ],
	];

    map READ_p2 = $[
	// targetpkg:
	"targetpkg": $[
	    // postfix
	    "installed": true,
	    ],
	];

    map WRITE = $[
	];

    DUMP ("sendmail");
    TEST (``(MailAliases::GetRootAlias ()), [READ_s], nil);
    TEST (``(MailAliases::SetRootAlias ("ruut")), [READ_s], nil);
    TEST (``(MailAliases::SetRootAlias ("")), [READ_s], nil);

    DUMP ("postfix");
    TEST (``(MailAliases::GetRootAlias ()), [[ READ_p1, READ_p2]], nil);
    // apparently the dumb^H^H^H^Hdummy aggent reads from the first map
    // while there's input.
    TEST (``(MailAliases::SetRootAlias ("ruut")), [[ READ_p1, READ_p2]], nil);
    TEST (``(MailAliases::SetRootAlias ("")), [[ READ_p1, READ_p2]], nil);
}
