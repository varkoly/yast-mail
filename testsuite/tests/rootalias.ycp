/**
 * Module:
 *   NIS client configuration
 *
 * Summary:
 *   Testsuite
 *
 * Authors:
 *   Martin Vidner <mvidner@suse.cz>
 *
 * $Id$
 */
{
    include "testsuite.ycp";
    TESTSUITE_INIT ([ $[], $[], $[] ], nil);
    import "MailAliases";

    list<map> aliases = [
	$["key": "foo", "value": "bar", "comment": "baz",],
	$["key": "root", "value": "leaf", "comment": "kuk",],
	$["key": "foo2", "value": "bar2", "comment": "baz2",],
	];

    // the test data is a bit convoluted because formerly
    // the data was read from .mail.{sendmail,postfix}.aliases.table

    map READ_s = $[
	// targetpkg:
	"targetpkg": $[
	    // sendmail
	    "installed": true,
	    ],
	// Mail itself:
	"mail": $[
	    "aliases": $[
		"table": aliases,
		],
	    ],
	];

    map READ_p1 = $[
	// targetpkg:
	"targetpkg": $[
	    // sendmail
	    "installed": false,
	    ],
	// Mail itself:
	"mail": $[
	    "aliases": $[
		"table": aliases,
		],
	    ],
	];

    map READ_p2 = $[
	// targetpkg:
	"targetpkg": $[
	    // postfix
	    "installed": true,
	    ],
	// Mail itself:
	"mail": $[
	    "aliases": $[
		"table": aliases,
		],
	    ],
	];

    map WRITE = $[
	];

    DUMP ("sendmail");
    TEST (``(MailAliases::GetRootAlias ()), [READ_s], nil);
    TEST (``(MailAliases::SetRootAlias ("ruut")), [READ_s], nil);
    TEST (``(MailAliases::SetRootAlias ("")), [READ_s], nil);

    DUMP ("postfix");
    TEST (``(MailAliases::GetRootAlias ()), [[ READ_p1, READ_p2]], nil);
    // apparently the dumb^H^H^H^Hdummy aggent reads from the first map
    // while there's input.
    TEST (``(MailAliases::SetRootAlias ("ruut")), [[ READ_p1, READ_p2]], nil);
    TEST (``(MailAliases::SetRootAlias ("")), [[ READ_p1, READ_p2]], nil);
}
